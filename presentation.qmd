---
title: Soccer Statistics Across Leagues
author: Skillful Pikachu <br> Henry Friedberg, Pranathi Adhikari, John Aclufi, Shara Shanmugasundaram 
title-slide-attributes:
  style: |
    .title {
      font-size: 50px;
    }
    .author {
      font-size: 40px;
    }
date: May 5, 2023
format: 
  revealjs:
    theme: "serif"
    scrollable: true
editor: visual
execute:
  echo: false
  cache: true
---

```{r}
#| label: setup
#| include: false
#| cache: false
library(tidyverse)
library(rcis)
library(scales) # formatting numbers
library(janitor)
library(skimr)
library(tidymodels)
library(openintro)
library(lubridate)

soccer <- read_csv("data/top_goalscorers.csv")
soccer <- clean_names(soccer)

soccer_clean <- soccer |>
  mutate(
    player_height_cm = as.numeric(gsub(" cm", "", soccer$player_height)),
    player_weight_kg = as.numeric(gsub(" kg", "", soccer$player_weight))
  ) |>
  select(-c(
    games_number, goals_saves, dribbles_past, penalty_won,
    penalty_commited, player_height, player_weight, penalty_saved,
    player_id_1, player_id_48, player_firstname, league_season
  ))

theme_set(theme_minimal(base_size = 16))
```

## Topic and Motivation

<br>

**Topic:** Analyze offensive stats for soccer players in various leagues during 2021 season.

**Motivation:** Find relationships between soccer players, leagues, and their stats.

<br>

**Research Questions:**

-   What factors influence booking frequency of players?
-   Does aggressiveness differ between European and non-European leagues?

## Data Introduction {.smaller}

::: columns
::: {.column width="50%"}
```{r}
#| label: data-introduction
#| message: false
#| warning: false
library(tidyverse)
library(skimr)
library(dplyr)
library(kableExtra)

soccer <- read_csv("data/top_goalscorers.csv")

soccer_display <- soccer |>
  select("player.name", "player.age", "goals.total") |>
  slice(1:5) |>
  rename("Player Name" = player.name, "Player Age" = player.age,
         "Goals Scored" = goals.total)


kable(soccer_display)

```
:::

::: {.column width="50%"}
<div>

-   Dataset contains the top 20 scorers from the top 27 football leagues for the 2021 league season.

    -   Rows: Individual Players

    -   Columns: Attributes

-   The data is used by football fans, sports bettors, and researchers

</div>
:::
:::

## Highlights from EDA Pt. 1

```{r}
#| label: eda-plots-1
#| message: false
#| warning: false
# Rating (cont) vs Bookings
soccer_clean |>
  mutate(
    total_bookings = cards_yellow + cards_red + cards_yellowred
  ) |>
  ggplot(mapping = aes(x = games_rating, y = total_bookings)) +
  geom_jitter() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    x = "Player Rating (Across Season Games)",
    y = "Total Bookings",
    title = "Do higher-rated players tend to get booked more frequently?"
  ) +
  theme_minimal()

# Rating (cat) vs Bookings
soccer_clean |>
  drop_na(games_rating) |>
  mutate(
    total_bookings = cards_yellow + cards_red + cards_yellowred,
    high_cat = if_else(games_rating >= mean(games_rating), 
                       "high rank", "non high rank"),
    high_cat = as.factor(high_cat)
  ) |>
  ggplot(mapping = aes(x = high_cat, y = total_bookings)) +
  geom_boxplot() +
  labs(
    x = "Player Rating (Across Season Games)",
    y = "Total Bookings",
    title = "Do highly-rated players tend to get booked more frequently than non-highly rated players?"
  ) +
  theme_minimal()
```

## Analysis Pt. 1

-   Used one-sided hypothesis test to determine whether or not the difference in true population means of highly rated players and non-highly rated players is significant

-   Null hypothesis: The true population mean for bookings of highly rated players and non-highly rated players are not different. $H_0 = \mu_{high} - \mu_{non-high} = 0$

-   Alternate hypothesis: The true population mean for bookings of highly rated players and non-highly rated players are different. $H_A = \mu_{high} - \mu_{non-high} \not= 0$

-   The p-value (0.02) is less than alpha i.e. significance level of 0.05, therefore we reject the null hypothesis

-   $$
    \widehat{bookings} = 12.372558 - 1.185715 \times player~rating
    $$

-   

## Highlights from EDA Pt. 2

```{r}
#| label: analysis-plots-2
#| message: false
#| warning: false

european_countries <- c("Belgium", "England", "France", "Germany", "Italy", 
                        "Netherlands", "Portugal", "Spain")

soccer_clean <- soccer_clean |>
  mutate(
    is_european = ifelse(league_country %in% european_countries, "Yes", "No")
  )

# How do goals per minutes (on average) (i.e. goals_total / games_minutes and 
# group_by(league)) differ within leagues?
soccer_clean |>
  mutate(
    # total_bookings = cards_yellow + cards_red + cards_yellowred,
    avg_goals_per_min = goals_total / games_minutes
  ) |>
  # filter(avg_goals_per_min <= 0.015) |>
  ggplot(mapping = aes(x = is_european, y = avg_goals_per_min)) +
  geom_boxplot() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    x = "European",
    y = "Average Goals per Minute",
    title = "Do European Leagues tend to have score more more goals, on average, 
than non-European leagues?"
  ) +
  theme_minimal()

# Does number of duels (duels_total) differ across leagues?
soccer_clean |>
  ggplot(mapping = aes(x = is_european, y = duels_total)) +
  geom_boxplot() +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    x = "European",
    y = "Total Duels",
    title = "Do European Leagues tend to duel more, on average, 
than non-European leagues?"
  ) +
  theme_minimal()
```

## Analysis Pt. 2

-   Used two-sided hypothesis test to determine whether or not the difference in true population means of average goals per minute for European leagues and non-European leagues are significant

-   Null hypothesis: The true population mean of goals per minute for European and non-European leagues are not different. $H_0 = \mu_{EU} - \mu_{non-EU} = 0$

-   Alternate hypothesis: The true population mean of goals per minute for European and non-European leagues are different. $H_A = \mu_{EU} - \mu_{non-EU} = 0$

-   The p-value (0.196) is greater than alpha i.e. significance level of 0.05, therefore we fail to reject the null hypothesis

-   $$ p = \frac{\exp\{-1.903256924 + 240.017572079 \times average~gpm + 0.004831097 \times duels\}}{1 + \exp\{-1.903256924 + 240.017572079 \times average~gpm + 0.004831097 \times duels\}}$$

-   95% confident that the difference between the true population means of duels for European and non-European leagues is between 30.63766 and 86.54825 (i.e. positive), implying that European leagues duel more than non-European leagues, on average.

## Conclusions

#### RQ1 Conclusion

-   What factors influence booking frequency of players?

    -   **We determined that rating was the only significant predictor of bookings in our analysis**

#### RQ2 Conclusion

-   Does aggressiveness differ between European and non-European leagues?

    -   **We determined that only average goals per minute and total dues are significant predictors when determining the league.**
